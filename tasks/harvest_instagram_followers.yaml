name: harvest_instagram_followers
description: Navigate directly to an artist's Instagram followers and extract profile data using vision LLM
target_package: com.instagram.android
timeout: 600
retry_count: 0
actions:
  # Open the artist's profile directly via URL
  - action: open_url
    url: "https://www.instagram.com/{task.artist_name}/"
  - action: sleep
    duration: 2.0

  # Handle browser chooser if it appears (tap "Just once" or Instagram)
  - action: if
    condition:
      text_on_screen: "Just once"
    then:
      - action: tap
        text: "Just once"
        timeout: 3
      - action: sleep
        duration: 3.0

  # Wait for Instagram to load the profile
  - action: sleep
    duration: 3.0

  # Detect what screen we landed on
  - action: detect_screen

  # Tap the followers count to open followers list
  # Try multiple patterns since Instagram UI varies
  - action: try
    actions:
      - action: tap
        text: followers
        timeout: 10
    on_error:
      - action: try
        actions:
          - action: tap
            text: Followers
            timeout: 5
        on_error:
          # Last resort: use detect_screen to log what we see
          - action: detect_screen
  - action: sleep
    duration: 3.0

  # Scroll and extract followers using vision LLM
  - action: repeat
    count: 10
    actions:
      - action: vision
        prompt: >
          Extract all visible follower profiles from this Instagram followers list screenshot.
          Return a JSON object with a "profiles" array. Each profile should have:
          - "username": the Instagram handle
          - "display_name": the full display name shown
          - "bio_snippet": any bio text visible (empty string if none)
          - "profile_pic_style": describe the profile picture briefly (e.g. "selfie", "logo", "landscape", "group photo", "cartoon")
          - "is_verified": true/false
          Return ONLY valid JSON, no markdown.
        max_tokens: 1000

      - action: swipe
        direction: up
      - action: random_sleep
        min: 1.5
        max: 3.0
